<!-- dx-header -->

## What does this app do?

This app runs a combination of tools to generate structural variant calls on whole-genome sequencing data. This tool runs the following callers: Breakdancer, Breakseq2, CNVnator, Delly2, Manta, and Lumpy. Because of synergies in how the programs use computational resources, these are all run in parallel. This app will produce the outputs of each of the tools for subsequent investigation.

If the option to genotype candidates is selected, this app will run SVTyper to genotype the events and will merge these tools with the program SURVIVOR. SV events that receive genotype calls have significantly higher specificity.

If the option to visualize candidates is selected, a tar file containing a PDF image for each SV call will be produced in order to summarize the supporting information behind the SV.

## What are typical use cases for this app?

This app is used to identify structural variants in a given sample relative to a reference genome. These structural variants cover large deletion events that are called as Deletions of a region, Insertions of a sequence into a region, Duplications of a region, Inversions of a region, or Translocations between two regions in the genome.

## What data are required for this app to run?

This app requires a BAM file containing the mapped reads of an individual relative to the reference genome. This app is intended for whole-genome sequencing. Providing exome or panel sequencing will not produce good results. It is intended to be run on a single germline sample.

In addition, the app requires the reference genome in gzipped FASTA format (`fa.gz` or `fasta.gz`). The reference genome should match the version used to generate the BAM file.

## What does this app output?

This app will output a number of files, representing the outputs of each of the structural variant callers. If the option to run a given step is unselected, then those outputs will not be provided.

- `lumpy.vcf`: representing the structural variant calls from Lumpy in VCF format.
- `lumpy.discordant.bam`: representing reads that Lumpy identified as discordant and used as evidence for its calls.
- `lumpy.splitters.bam`: representing reads that Lumpy identified as split-read mapped and used as evidence for its calls.
- `manta.diploidSV.vcf`: representing genotyped structural variant calls from Manta in VCF format.
- `manta.alignmentStats.txt`: representing statistics about the alignment from Manta.
- `breakdancer.ctx`: representing structural variant calls in Breakdancer's format.
- `cnvnator.output`: representing structural variant calls in CNVnator's format.
- `cnvnator.vcf`: representing structural variant calls from CNVnator in VCF format (this represents the conversion of CNVnator output to VCF format).
- `breakseq.gff`: representing structural variant calls from Breakseq2 in GFF format.
- `breakseq.vcf`: representing structural variant calls from Breakseq2 in VCF format.
- `breakseq.bam`: representing the reads mapping used as evidence for the calls generated by Breakseq2.
- `delly.deletion.vcf`: representing deletion calls made by Delly2.
- `delly.inversion.vcf`: representing inversion calls made by Delly2.
- `delly.duplication.vcf`: representing duplication calls made by Delly2.
- `delly.insertion.vcf`: representing insertion calls made by Delly2.
- `delly.translocation.vcf`: representing translocation calls made by Delly2.

- `<caller>.svtyped.vcf`: If the option to genotype candidates is selected, a genotype VCF produced by svtyper will be generated for each caller output.
- `combined.genotyped.vcf`: If the option to genotype candidates is selected, a merged VCF file of all of the callers will be produced by SURVIVOR.

- `svviz_outputs.tar.gz`: If the option to visualize events is selected, a tarball containing a set of PDFs documenting the genomic regions for calls will be generated

## Additional Notes

Because the field of structural variation is relatively new and complex, we viewed placing a dependency on all individual tools completing successfully as a requirement for a successful run to be too strict. In other words, if one of these tools fails while the others succeed, the app will output the results of the tools that completed and will not itself fail.

Breakseq2 may only be able to work when using the 1000 Genomes reference genome (hs37d5). For other reference genomes, you may not get Breakseq2 results.

The svviz tool can at times consume a large amount of memory, causing the application to be killed. If you see 
a message like:
```
Out of memory: Kill process XXXX (svviz) score 112 or sacrifice child
```
in the log, you should kill the job if it is still running and retry on a machine with more memory or without enabling svviz.


Parliament2 is open-source and can be found here: <https://github.com/dnanexus/parliament2>. The Docker container can be found here: <https://hub.docker.com/r/dnanexus/parliament2/>.

## Supporting information

For additional information, please see the following papers:

- Lumpy: Ryan M Layer, Colby Chiang, Aaron R Quinlan, and Ira M Hall. 2014. "LUMPY: a Probabilistic Framework for Structural Variant Discovery." Genome Biology 15 (6): R84. doi:10.1186/gb-2014-15-6-r84
- Manta: Chen X, Schulz-Trieglaff O, Shaw R, Barnes B, Schlesinger F, Källberg M, Cox AJ, Kruglyak S, Saunders CT. 2015 "Manta: rapid detection of structural variants and indels for germline and cancer sequencing applications." Bioinformatics. doi: 10.1093/bioinformatics/btv710
- Breakdancer: Chen K, Wallis JW, McLellan MD, Larson DE, Kalicki JM, Pohl CS, McGrath SD, Wendl MC, Zhang Q, Locke DP, Shi X, Fulton RS, Ley TJ, Wilson RK, Ding L, Mardis ER. 2009. "BreakDancer: an algorithm for high-resolution mapping of genomic structural variation". Nature Methods 6. doi:10.1038/nmeth.1363
- Breakseq2: Abyzov A, Li S, Kim DR, Mohiyuddin M, Stütz AM, Parrish NF, Mu XJ, Clark W, Chen K, Hurles M, Korbel JO, Lam HYK, Lee C, Gerstein MB. 2015. "Analysis of deletion breakpoints from 1,092 humans reveals details of mutation mechanisms". Nature Communications 6. doi:10.1038/ncomms8256
- Delly2: Tobias Rausch, Thomas Zichner, Andreas Schlattl, Adrian M. Stuetz, Vladimir Benes, Jan O. Korbel. 2012. Delly: structural variant discovery by integrated paired-end and split-read analysis. Bioinformatics 28:i333-i339. doi: 10.1093/bioinformatics/bts378
- CNVnator: Abyzov A, Urban AE, Snyder M, Gerstein M. 2011. "CNVnator: an approach to discover, genotype, and characterize typical and atypical CNVs from family and population genome sequencing". Genome Research (6):974. doi: 10.1101/gr.114876.110
- Parliament: Adam C English, William J Salerno, Oliver A Hampton, Claudia Gonzaga-Jauregui, Shruthi Ambreth, Deborah I Ritter, Christine R Beck, Caleb F Davis, Mahmoud Dahdouli, Singer Ma, Andrew Carroll, Narayanan Veeraraghavan, Jeremy Bruestle, Becky Drees, Alex Hastie, Ernest T Lam, Simon White, Pamela Mishra, Min Wang, Yi Han, Feng Zhang, Pawel Stankiewicz, David A Wheeler, Jeffrey G Reid, Donna M Muzny, Jeffrey Rogers, Aniko Sabo, Kim C Worley, James R Lupski, Eric Boerwinkle and Richard A Gibbs. Assessing structural variation in a personal genome—towards a human reference diploid genome. BMC Genomics 2015, 16:286  doi:10.1186/s12864-015-1479-3.
